{% load personalise_extras wagtailimages_tags wagtailcore_tags static gem_tags %}

{% block content %}
{% filter_surveys_by_segments surveys request as filtered_surveys %}
    {% for survey in filtered_surveys %}
      {% with survey=survey.molo_survey_page form=survey.form %}
        {% if survey.your_words_competition %}

            {# include template "patterns/basics/surveys/surveys-list_gcn.html" #}
              <div class="gcn-competition gcn-competition--homepage gcn-competition{{survey.get_effective_extra_style_hints}}">
                  {% include "patterns/basics/surveys/surveys-modules/surveys_gcn-heading.html" with pagetype=survey %}
                  {%  if survey.homepage_introduction %}
                      {% include "patterns/basics/headings/sp_variations/heading.html" with type="subheading" htmltag="p" title=survey.homepage_introduction|smarttruncatechars:100|safe %}
                  {% endif %}

                  {% trans "Take GCN competition" as buttontext %}
                  {% with trans_buttontext=survey.homepage_button_text|default:buttontext %}
                  {% pageurl survey.specific as the_url %}
                  {% include "patterns/basics/buttons/sp_variations/button.html" with type="primary" hyperlink=the_url text=trans_buttontext %}
                  {% endwith %}
              </div>
            {# end include template #}
        {% elif survey.display_survey_directly %}

            {# include template "patterns/basics/surveys/surveys-list_polls.html" #}
              <div class="polls polls--call-to-action">
                <div class="polls__bubble-icon"></div>
                <div class="polls__container">
                  {% trans "Take a vote!" as headingtext %}
                  {% include "patterns/basics/headings/sp_variations/heading.html" with type="micro" htmltag="p" title=headingtext %}

                  {% include "patterns/basics/headings/sp_variations/heading.html" with type="subheading" htmltag="h3" title=survey.title %}
                    {% if survey.homepage_introduction %}
                        {% include "patterns/basics/headings/sp_variations/heading.html" with type="subheading" htmltag="p" title=survey.homepage_introduction|smarttruncatechars:100|safe %}
                    {% endif %}
                    {% if form %}
                      {% include "patterns/basics/surveys/surveys-modules/form.html"  with  surveytype="poll" surveytypeClass="polls" %}
                    {% else %}
                        {% include "patterns/basics/surveys/surveys-modules/surveys-feeback.html" with surveytype="poll" surveytypeClass="polls" %}
                    {% endif %}
                </div>
              </div>
            {# end include template #}

        {% else %}

            {# include template "patterns/basics/surveys/surveys-list_generic.html" #}
              {% if user.is_authenticated and user.is_active or request.is_preview or survey.allow_anonymous_submissions %}
              <div class="adv_wrapper adv_wrapper--surveys adv_wrapper{{survey.get_effective_extra_style_hints}}">
                <aside>
                  {% if survey.image %}
                    {% image survey.image width-165 as icon_small %}
                    <img src="{{ icon_small.url }}" alt="{{ self.title }}" class="adv_wrapper__item-icon" />
                  {% else %}
                    <img src="{% static 'img/icons/think_purple_HR.png' %}" width="115" class="adv_wrapper__item-icon" />
                  {% endif %}
                </aside>
                <section>
                  {% include "patterns/basics/headings/sp_variations/heading.html" with type="component" htmltag="h1" title=survey.title %}
                  {%  if survey.homepage_introduction %}
                      {% include "patterns/basics/headings/sp_variations/heading.html" with type="subheading" htmltag="p" title=survey.homepage_introduction|smarttruncatechars:100|safe %}
                  {% endif %}
                </section>
                <nav>
                  {% trans "Take Survey" as buttontext %}
                  {% with trans_buttontext=survey.homepage_button_text|default:buttontext %}
                      {% pageurl survey.specific as the_url %}
                      {% include "patterns/basics/buttons/sp_variations/button.html" with type="primary" hyperlink=the_url text=trans_buttontext %}
                  {% endwith %}
                </nav>
              </div>
              {% else %}
                  {% include "patterns/components/banners/join-banner.html" %}
              {% endif %}
            {# end include template #}

        {% endif %}
      {% endwith %}
    {% endfor %}
{% endblock %}
